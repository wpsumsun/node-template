# Node.js é¡¹ç›®å®Œæ•´ä¸Šçº¿éƒ¨ç½²æµç¨‹

> ä»é›¶åˆ°ä¸Šçº¿çš„å®Œæ•´æŒ‡å—ï¼Œé€‚åˆæ–°æ‰‹å‚è€ƒ

---

## ğŸ“‹ ç›®å½•

1. [æœ¬åœ°å¼€å‘](#1-æœ¬åœ°å¼€å‘)
2. [ä»£ç ç®¡ç†](#2-ä»£ç ç®¡ç†)
3. [æœåŠ¡å™¨å‡†å¤‡](#3-æœåŠ¡å™¨å‡†å¤‡)
4. [éƒ¨ç½²ä»£ç ](#4-éƒ¨ç½²ä»£ç )
5. [Nginx é…ç½®](#5-nginx-é…ç½®)
6. [HTTPS é…ç½®](#6-https-é…ç½®)
7. [è‡ªåŠ¨åŒ–éƒ¨ç½²](#7-è‡ªåŠ¨åŒ–éƒ¨ç½²)
8. [ç›‘æ§å’Œæ—¥å¿—](#8-ç›‘æ§å’Œæ—¥å¿—)
9. [å¸¸è§é—®é¢˜](#9-å¸¸è§é—®é¢˜)

---

## 1. æœ¬åœ°å¼€å‘

### 1.1 æ ‡å‡†é¡¹ç›®ç»“æ„

```
my-project/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ controllers/      # æ§åˆ¶å™¨ï¼ˆå¤„ç†ä¸šåŠ¡é€»è¾‘ï¼‰
â”‚   â”œâ”€â”€ models/          # æ•°æ®æ¨¡å‹
â”‚   â”œâ”€â”€ routes/          # è·¯ç”±å®šä¹‰
â”‚   â”œâ”€â”€ middlewares/     # ä¸­é—´ä»¶
â”‚   â”œâ”€â”€ services/        # æœåŠ¡å±‚
â”‚   â”œâ”€â”€ utils/           # å·¥å…·å‡½æ•°
â”‚   â””â”€â”€ app.js           # Express åº”ç”¨å…¥å£
â”œâ”€â”€ config/
â”‚   â”œâ”€â”€ database.js      # æ•°æ®åº“é…ç½®
â”‚   â””â”€â”€ config.js        # å…¶ä»–é…ç½®
â”œâ”€â”€ tests/               # æµ‹è¯•æ–‡ä»¶
â”œâ”€â”€ logs/                # æ—¥å¿—ç›®å½•
â”œâ”€â”€ .env                 # ç¯å¢ƒå˜é‡ï¼ˆä¸æäº¤ï¼‰
â”œâ”€â”€ .env.example         # ç¯å¢ƒå˜é‡ç¤ºä¾‹
â”œâ”€â”€ .gitignore          # Git å¿½ç•¥æ–‡ä»¶
â”œâ”€â”€ package.json
â”œâ”€â”€ ecosystem.config.js  # PM2 é…ç½®
â””â”€â”€ README.md
```

### 1.2 package.json é…ç½®

```json
{
  "name": "my-api",
  "version": "1.0.0",
  "main": "src/app.js",
  "scripts": {
    "start": "node src/app.js",
    "dev": "nodemon src/app.js",
    "test": "jest",
    "lint": "eslint ."
  },
  "dependencies": {
    "express": "^4.18.2",
    "dotenv": "^16.3.1",
    "cors": "^2.8.5",
    "helmet": "^7.1.0",
    "morgan": "^1.10.0",
    "compression": "^1.7.4"
  },
  "devDependencies": {
    "nodemon": "^3.0.2",
    "eslint": "^8.56.0"
  }
}
```

### 1.3 ç¯å¢ƒå˜é‡é…ç½®

**.env.example**
```bash
# åº”ç”¨é…ç½®
NODE_ENV=development
PORT=3000
APP_NAME=My API

# æ•°æ®åº“
DB_HOST=localhost
DB_PORT=3306
DB_NAME=mydb
DB_USER=root
DB_PASSWORD=password

# JWT
JWT_SECRET=your-secret-key
JWT_EXPIRES_IN=7d

# Redisï¼ˆå¯é€‰ï¼‰
REDIS_HOST=localhost
REDIS_PORT=6379
```

---

## 2. ä»£ç ç®¡ç†

### 2.1 åˆå§‹åŒ– Git ä»“åº“

```bash
# åˆå§‹åŒ–
git init

# åˆ›å»º .gitignore
cat > .gitignore << 'EOF'
node_modules/
.env
*.log
logs/
dist/
coverage/
.DS_Store
EOF

# ç¬¬ä¸€æ¬¡æäº¤
git add .
git commit -m "Initial commit"
```

### 2.2 æ¨é€åˆ°è¿œç¨‹ä»“åº“

```bash
# æ·»åŠ è¿œç¨‹ä»“åº“ï¼ˆGitHub/GitLab/Giteeï¼‰
git remote add origin https://github.com/username/my-api.git

# æ¨é€ä»£ç 
git push -u origin main
```

---

## 3. æœåŠ¡å™¨å‡†å¤‡

### 3.1 è¿æ¥æœåŠ¡å™¨

```bash
# SSH è¿æ¥
ssh root@your-server-ip

# æˆ–ä½¿ç”¨é˜¿é‡Œäº‘æ§åˆ¶å°çš„è¿œç¨‹è¿æ¥åŠŸèƒ½
```

### 3.2 å®‰è£…å¿…è¦è½¯ä»¶

#### CentOS/Alibaba Cloud Linux

```bash
# æ›´æ–°ç³»ç»Ÿ
sudo yum update -y

# å®‰è£…åŸºç¡€å·¥å…·
sudo yum install -y git wget curl vim

# å®‰è£… Node.js 18.x LTS
curl -fsSL https://rpm.nodesource.com/setup_18.x | sudo bash -
sudo yum install -y nodejs

# éªŒè¯å®‰è£…
node -v
npm -v

# å®‰è£… PM2
sudo npm install -g pm2

# å®‰è£… Nginx
sudo yum install -y nginx
```

#### Ubuntu/Debian

```bash
# æ›´æ–°ç³»ç»Ÿ
sudo apt update && sudo apt upgrade -y

# å®‰è£…åŸºç¡€å·¥å…·
sudo apt install -y git wget curl vim

# å®‰è£… Node.js 18.x LTS
curl -fsSL https://deb.nodesource.com/setup_18.x | sudo -E bash -
sudo apt install -y nodejs

# éªŒè¯å®‰è£…
node -v
npm -v

# å®‰è£… PM2
sudo npm install -g pm2

# å®‰è£… Nginx
sudo apt install -y nginx
```

### 3.3 åˆ›å»ºéƒ¨ç½²ç”¨æˆ·ï¼ˆæ¨èï¼‰

```bash
# åˆ›å»ºç”¨æˆ·
sudo adduser deploy
sudo passwd deploy

# èµ‹äºˆ sudo æƒé™ï¼ˆCentOSï¼‰
sudo usermod -aG wheel deploy

# æˆ–è€…ï¼ˆUbuntuï¼‰
sudo usermod -aG sudo deploy

# åˆ‡æ¢åˆ°éƒ¨ç½²ç”¨æˆ·
su - deploy
```

### 3.4 é…ç½® SSH å¯†é’¥ï¼ˆå…å¯†ç™»å½•ï¼‰

**åœ¨æœ¬åœ°æ‰§è¡Œï¼š**
```bash
# ç”Ÿæˆå¯†é’¥ï¼ˆå¦‚æœè¿˜æ²¡æœ‰ï¼‰
ssh-keygen -t rsa -b 4096 -C "your_email@example.com"

# å¤åˆ¶å…¬é’¥åˆ°æœåŠ¡å™¨
ssh-copy-id deploy@your-server-ip
```

### 3.5 é…ç½®é˜²ç«å¢™

```bash
# CentOS/Alibaba Cloud Linux
sudo firewall-cmd --permanent --add-service=http
sudo firewall-cmd --permanent --add-service=https
sudo firewall-cmd --permanent --add-port=3000/tcp
sudo firewall-cmd --reload

# Ubuntu
sudo ufw allow 22/tcp
sudo ufw allow 80/tcp
sudo ufw allow 443/tcp
sudo ufw allow 3000/tcp
sudo ufw enable
```

### 3.6 é˜¿é‡Œäº‘å®‰å…¨ç»„é…ç½®

1. ç™»å½•é˜¿é‡Œäº‘æ§åˆ¶å°
2. è¿›å…¥ ECS â†’ å®‰å…¨ç»„ â†’ é…ç½®è§„åˆ™
3. æ·»åŠ å…¥æ–¹å‘è§„åˆ™ï¼š
   - HTTPï¼š`80/80`ï¼Œæˆæƒå¯¹è±¡ï¼š`0.0.0.0/0`
   - HTTPSï¼š`443/443`ï¼Œæˆæƒå¯¹è±¡ï¼š`0.0.0.0/0`
   - Node.jsï¼š`3000/3000`ï¼Œæˆæƒå¯¹è±¡ï¼š`0.0.0.0/0`

---

## 4. éƒ¨ç½²ä»£ç 

### 4.1 å…‹éš†ä»£ç 

```bash
# åˆ›å»ºåº”ç”¨ç›®å½•
mkdir -p ~/apps
cd ~/apps

# å…‹éš†ä»£ç 
git clone https://github.com/username/my-api.git
cd my-api

# æˆ–ä½¿ç”¨ SSH å…‹éš†ï¼ˆæ¨èï¼‰
git clone git@github.com:username/my-api.git
```

### 4.2 å®‰è£…ä¾èµ–

```bash
# ç”Ÿäº§ç¯å¢ƒå®‰è£…ï¼ˆä¸å®‰è£… devDependenciesï¼‰
npm install --production

# æˆ–ä½¿ç”¨å›½å†…é•œåƒåŠ é€Ÿ
npm install --production --registry=https://registry.npmmirror.com
```

### 4.3 é…ç½®ç¯å¢ƒå˜é‡

```bash
# å¤åˆ¶ç¯å¢ƒå˜é‡æ¨¡æ¿
cp .env.example .env

# ç¼–è¾‘é…ç½®
nano .env

# ä¿®æ”¹ä¸ºç”Ÿäº§ç¯å¢ƒé…ç½®ï¼š
# NODE_ENV=production
# PORT=3000
# DB_HOST=your-db-host
# DB_PASSWORD=strong-password
# JWT_SECRET=production-secret-key
```

### 4.4 ä½¿ç”¨ PM2 å¯åŠ¨

#### æ–¹å¼ 1ï¼šç›´æ¥å¯åŠ¨

```bash
# å¯åŠ¨åº”ç”¨
pm2 start src/app.js --name "my-api"

# æŸ¥çœ‹çŠ¶æ€
pm2 list

# æŸ¥çœ‹æ—¥å¿—
pm2 logs my-api

# è®¾ç½®å¼€æœºè‡ªå¯
pm2 startup
pm2 save
```

#### æ–¹å¼ 2ï¼šä½¿ç”¨é…ç½®æ–‡ä»¶ï¼ˆæ¨èï¼‰

åˆ›å»º `ecosystem.config.js`ï¼š

```javascript
module.exports = {
  apps: [{
    name: 'my-api',
    script: './src/app.js',
    instances: 'max',       // é›†ç¾¤æ¨¡å¼ï¼Œä½¿ç”¨æ‰€æœ‰ CPU æ ¸å¿ƒ
    exec_mode: 'cluster',
    watch: false,
    max_memory_restart: '500M',
    env: {
      NODE_ENV: 'development',
      PORT: 3000
    },
    env_production: {
      NODE_ENV: 'production',
      PORT: 3000
    },
    error_file: './logs/pm2-err.log',
    out_file: './logs/pm2-out.log',
    log_date_format: 'YYYY-MM-DD HH:mm:ss',
    merge_logs: true,
    autorestart: true
  }]
};
```

å¯åŠ¨ï¼š
```bash
pm2 start ecosystem.config.js --env production
pm2 save
```

---

## 5. Nginx é…ç½®

### 5.1 åˆ›å»º Nginx é…ç½®æ–‡ä»¶

```bash
sudo nano /etc/nginx/conf.d/my-api.conf
```

### 5.2 åŸºç¡€é…ç½®ï¼ˆåå‘ä»£ç†ï¼‰

```nginx
# ä¸Šæ¸¸æœåŠ¡å™¨ï¼ˆNode.jsï¼‰
upstream nodejs_backend {
    least_conn;
    server 127.0.0.1:3000;
    keepalive 64;
}

server {
    listen 80;
    server_name yourdomain.com;  # æ›¿æ¢ä¸ºä½ çš„åŸŸåæˆ– IP

    # æ—¥å¿—
    access_log /var/log/nginx/my-api-access.log;
    error_log /var/log/nginx/my-api-error.log;

    # å®‰å…¨å¤´
    add_header X-Frame-Options "SAMEORIGIN" always;
    add_header X-Content-Type-Options "nosniff" always;
    add_header X-XSS-Protection "1; mode=block" always;

    # API ä»£ç†
    location /api/ {
        proxy_pass http://nodejs_backend;
        proxy_http_version 1.1;

        # WebSocket æ”¯æŒ
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';

        # ä¼ é€’çœŸå®å®¢æˆ·ç«¯ä¿¡æ¯
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;

        # è¶…æ—¶è®¾ç½®
        proxy_connect_timeout 60s;
        proxy_send_timeout 60s;
        proxy_read_timeout 60s;

        # ç¼“å­˜æ§åˆ¶
        proxy_cache_bypass $http_upgrade;
    }

    # é™æ€æ–‡ä»¶
    location / {
        root /usr/share/nginx/html;
        index index.html;
        try_files $uri $uri/ /index.html;
    }

    # å¥åº·æ£€æŸ¥
    location /health {
        access_log off;
        return 200 "healthy\n";
        add_header Content-Type text/plain;
    }
}
```

### 5.3 æµ‹è¯•å¹¶é‡å¯ Nginx

```bash
# æµ‹è¯•é…ç½®æ–‡ä»¶
sudo nginx -t

# é‡å¯ Nginx
sudo systemctl restart nginx

# è®¾ç½®å¼€æœºè‡ªå¯
sudo systemctl enable nginx
```

---

## 6. HTTPS é…ç½®

### 6.1 ä½¿ç”¨ Let's Encrypt å…è´¹è¯ä¹¦

```bash
# å®‰è£… Certbotï¼ˆCentOSï¼‰
sudo yum install certbot python3-certbot-nginx -y

# æˆ– Ubuntu
sudo apt install certbot python3-certbot-nginx -y

# è·å–è¯ä¹¦å¹¶è‡ªåŠ¨é…ç½® Nginx
sudo certbot --nginx -d yourdomain.com -d www.yourdomain.com

# æµ‹è¯•è‡ªåŠ¨ç»­æœŸ
sudo certbot renew --dry-run

# æ·»åŠ è‡ªåŠ¨ç»­æœŸä»»åŠ¡
sudo crontab -e
# æ·»åŠ ï¼š
0 3 * * * certbot renew --quiet
```

### 6.2 HTTPS é…ç½®ï¼ˆCertbot ä¼šè‡ªåŠ¨ç”Ÿæˆï¼‰

```nginx
server {
    listen 443 ssl http2;
    server_name yourdomain.com;

    ssl_certificate /etc/letsencrypt/live/yourdomain.com/fullchain.pem;
    ssl_certificate_key /etc/letsencrypt/live/yourdomain.com/privkey.pem;
    ssl_protocols TLSv1.2 TLSv1.3;
    ssl_ciphers HIGH:!aNULL:!MD5;

    # ... å…¶ä»–é…ç½®
}

# HTTP é‡å®šå‘åˆ° HTTPS
server {
    listen 80;
    server_name yourdomain.com;
    return 301 https://$server_name$request_uri;
}
```

---

## 7. è‡ªåŠ¨åŒ–éƒ¨ç½²

### 7.1 ç®€å•éƒ¨ç½²è„šæœ¬

åˆ›å»º `deploy.sh`ï¼š

```bash
#!/bin/bash
set -e

APP_DIR="/home/deploy/apps/my-api"
BRANCH="main"

echo "ğŸš€ å¼€å§‹éƒ¨ç½²..."

# è¿›å…¥é¡¹ç›®ç›®å½•
cd $APP_DIR

# æ‹‰å–æœ€æ–°ä»£ç 
echo "ğŸ“¥ æ‹‰å–æœ€æ–°ä»£ç ..."
git pull origin $BRANCH

# å®‰è£…ä¾èµ–
echo "ğŸ“¦ å®‰è£…ä¾èµ–..."
npm install --production

# é‡å¯ PM2
echo "ğŸ”„ é‡å¯åº”ç”¨..."
pm2 restart my-api

# æŸ¥çœ‹çŠ¶æ€
pm2 list

echo "âœ… éƒ¨ç½²å®Œæˆï¼"
echo "ğŸ“Š æŸ¥çœ‹æ—¥å¿—ï¼špm2 logs my-api"
```

ä½¿ç”¨ï¼š
```bash
chmod +x deploy.sh
./deploy.sh
```

### 7.2 GitHub Actions è‡ªåŠ¨éƒ¨ç½²

åˆ›å»º `.github/workflows/deploy.yml`ï¼š

```yaml
name: Deploy to Production

on:
  push:
    branches: [ main ]

jobs:
  deploy:
    runs-on: ubuntu-latest

    steps:
    - name: Deploy via SSH
      uses: appleboy/ssh-action@master
      with:
        host: ${{ secrets.SERVER_IP }}
        username: ${{ secrets.SERVER_USER }}
        key: ${{ secrets.SSH_PRIVATE_KEY }}
        script: |
          cd ~/apps/my-api
          git pull origin main
          npm install --production
          pm2 restart my-api
          pm2 list
```

é…ç½® GitHub Secretsï¼š
1. è¿›å…¥ä»“åº“ Settings â†’ Secrets â†’ Actions
2. æ·»åŠ ï¼š
   - `SERVER_IP`ï¼šæœåŠ¡å™¨ IP
   - `SERVER_USER`ï¼šSSH ç”¨æˆ·å
   - `SSH_PRIVATE_KEY`ï¼šç§é’¥å†…å®¹

---

## 8. ç›‘æ§å’Œæ—¥å¿—

### 8.1 PM2 ç›‘æ§

```bash
# å®æ—¶ç›‘æ§
pm2 monit

# æŸ¥çœ‹æ—¥å¿—
pm2 logs my-api

# æŸ¥çœ‹è¯¦ç»†ä¿¡æ¯
pm2 show my-api

# é‡å¯åº”ç”¨
pm2 restart my-api

# åœæ­¢åº”ç”¨
pm2 stop my-api

# åˆ é™¤åº”ç”¨
pm2 delete my-api
```

### 8.2 æ—¥å¿—è½®è½¬

```bash
# å®‰è£… PM2 æ—¥å¿—è½®è½¬æ¨¡å—
pm2 install pm2-logrotate

# é…ç½®
pm2 set pm2-logrotate:max_size 10M
pm2 set pm2-logrotate:retain 7
pm2 set pm2-logrotate:compress true
```

### 8.3 ç³»ç»Ÿç›‘æ§

```bash
# å®‰è£… htop
sudo yum install htop -y  # CentOS
sudo apt install htop -y  # Ubuntu

# æŸ¥çœ‹ç³»ç»Ÿèµ„æº
htop

# æŸ¥çœ‹ Nginx æ—¥å¿—
sudo tail -f /var/log/nginx/my-api-access.log
sudo tail -f /var/log/nginx/my-api-error.log

# æŸ¥çœ‹ç³»ç»Ÿæ—¥å¿—
sudo journalctl -u nginx -f
```

---

## 9. å¸¸è§é—®é¢˜

### 9.1 ç«¯å£è¢«å ç”¨

```bash
# æŸ¥çœ‹ç«¯å£å ç”¨
sudo netstat -tlnp | grep 3000
# æˆ–
sudo lsof -i :3000

# æ€æ­»è¿›ç¨‹
kill -9 <PID>
```

### 9.2 PM2 å¯åŠ¨å¤±è´¥

```bash
# æŸ¥çœ‹è¯¦ç»†æ—¥å¿—
pm2 logs my-api --err

# æ£€æŸ¥æ–‡ä»¶è·¯å¾„æ˜¯å¦æ­£ç¡®
cd ~/apps/my-api
ls -la src/app.js

# æ‰‹åŠ¨è¿è¡Œæµ‹è¯•
node src/app.js
```

### 9.3 Nginx 502 Bad Gateway

```bash
# æ£€æŸ¥ Node.js åº”ç”¨æ˜¯å¦è¿è¡Œ
pm2 list

# æ£€æŸ¥ç«¯å£ç›‘å¬
sudo netstat -tlnp | grep 3000

# æŸ¥çœ‹ Nginx é”™è¯¯æ—¥å¿—
sudo tail -f /var/log/nginx/error.log

# æ£€æŸ¥é˜²ç«å¢™
sudo firewall-cmd --list-all
```

### 9.4 HTTPS è¯ä¹¦é—®é¢˜

```bash
# æ£€æŸ¥è¯ä¹¦çŠ¶æ€
sudo certbot certificates

# æ‰‹åŠ¨ç»­æœŸ
sudo certbot renew

# æŸ¥çœ‹è¯ä¹¦è¿‡æœŸæ—¶é—´
sudo certbot renew --dry-run
```

### 9.5 å†…å­˜ä¸è¶³

```bash
# åˆ›å»º Swapï¼ˆè™šæ‹Ÿå†…å­˜ï¼‰
sudo fallocate -l 2G /swapfile
sudo chmod 600 /swapfile
sudo mkswap /swapfile
sudo swapon /swapfile

# æ°¸ä¹…ç”Ÿæ•ˆ
echo '/swapfile none swap sw 0 0' | sudo tee -a /etc/fstab

# æŸ¥çœ‹å†…å­˜
free -h
```

---

## 10. éƒ¨ç½²æ£€æŸ¥æ¸…å•

### éƒ¨ç½²å‰
- [ ] ä»£ç å·²æ¨é€åˆ° Git
- [ ] ç¯å¢ƒå˜é‡å·²é…ç½®
- [ ] æ•°æ®åº“å·²å‡†å¤‡å¥½
- [ ] åŸŸå DNS å·²è§£æï¼ˆå¦‚æœä½¿ç”¨åŸŸåï¼‰

### æœåŠ¡å™¨é…ç½®
- [ ] Node.js å·²å®‰è£…
- [ ] PM2 å·²å®‰è£…
- [ ] Nginx å·²å®‰è£…
- [ ] é˜²ç«å¢™å·²é…ç½®
- [ ] å®‰å…¨ç»„å·²é…ç½®

### åº”ç”¨éƒ¨ç½²
- [ ] ä»£ç å·²å…‹éš†åˆ°æœåŠ¡å™¨
- [ ] ä¾èµ–å·²å®‰è£…
- [ ] PM2 å·²å¯åŠ¨åº”ç”¨
- [ ] Nginx å·²é…ç½®åå‘ä»£ç†
- [ ] HTTPS è¯ä¹¦å·²é…ç½®

### æµ‹è¯•éªŒè¯
- [ ] å¥åº·æ£€æŸ¥æ¥å£æ­£å¸¸
- [ ] API æ¥å£æ­£å¸¸å“åº”
- [ ] æ—¥å¿—æ­£å¸¸è¾“å‡º
- [ ] ç›‘æ§æ­£å¸¸è¿è¡Œ

---

## 11. æ€§èƒ½ä¼˜åŒ–å»ºè®®

### 11.1 åº”ç”¨å±‚ä¼˜åŒ–
- ä½¿ç”¨ PM2 é›†ç¾¤æ¨¡å¼ï¼ˆ`instances: 'max'`ï¼‰
- å¯ç”¨ Gzip å‹ç¼©
- åˆç†è®¾ç½®è¿æ¥æ± 
- ä½¿ç”¨ Redis ç¼“å­˜çƒ­ç‚¹æ•°æ®
- æ•°æ®åº“æŸ¥è¯¢ä¼˜åŒ–

### 11.2 Nginx ä¼˜åŒ–
```nginx
# Gzip å‹ç¼©
gzip on;
gzip_types text/plain text/css application/json application/javascript;

# ç¼“å­˜é™æ€æ–‡ä»¶
location ~* \.(jpg|jpeg|png|gif|ico|css|js)$ {
    expires 7d;
}

# è¿æ¥ä¿æŒ
keepalive_timeout 65;
keepalive_requests 100;
```

### 11.3 ç³»ç»Ÿä¼˜åŒ–
```bash
# è°ƒæ•´ç³»ç»Ÿé™åˆ¶
sudo nano /etc/security/limits.conf
# æ·»åŠ ï¼š
* soft nofile 65535
* hard nofile 65535
```

---

## 12. å®‰å…¨å»ºè®®

1. **ä¸è¦ç”¨ root ç”¨æˆ·è¿è¡Œåº”ç”¨**
2. **å®šæœŸæ›´æ–°ç³»ç»Ÿå’Œä¾èµ–åŒ…**
3. **ä½¿ç”¨å¼ºå¯†ç å’Œ SSH å¯†é’¥**
4. **é…ç½®é˜²ç«å¢™ï¼Œåªå¼€æ”¾å¿…è¦ç«¯å£**
5. **å®‰è£… fail2ban é˜²æ­¢æš´åŠ›ç ´è§£**
6. **å®šæœŸå¤‡ä»½æ•°æ®**
7. **ä½¿ç”¨ç¯å¢ƒå˜é‡å­˜å‚¨æ•æ„Ÿä¿¡æ¯**
8. **å¯ç”¨ HTTPS**
9. **é…ç½®è¯·æ±‚é™æµ**
10. **ç›‘æ§å¼‚å¸¸æ—¥å¿—**

---

## 13. å¤‡ä»½ç­–ç•¥

### 13.1 ä»£ç å¤‡ä»½
```bash
# å®šæœŸæäº¤åˆ° Git
git commit -am "Update"
git push origin main
```

### 13.2 æ•°æ®åº“å¤‡ä»½
```bash
# MySQL å¤‡ä»½è„šæœ¬
#!/bin/bash
DATE=$(date +%Y%m%d)
mysqldump -u root -p mydb > ~/backups/db-$DATE.sql
find ~/backups -name "db-*.sql" -mtime +7 -delete
```

### 13.3 æ–‡ä»¶å¤‡ä»½
```bash
# å®šæ—¶ä»»åŠ¡
crontab -e
# æ¯å¤©å‡Œæ™¨ 2 ç‚¹å¤‡ä»½
0 2 * * * ~/backup.sh
```

---

## ğŸ“š ç›¸å…³èµ„æº

- [Node.js å®˜æ–¹æ–‡æ¡£](https://nodejs.org/docs/)
- [Express å®˜æ–¹æ–‡æ¡£](https://expressjs.com/)
- [PM2 å®˜æ–¹æ–‡æ¡£](https://pm2.keymetrics.io/)
- [Nginx å®˜æ–¹æ–‡æ¡£](https://nginx.org/en/docs/)
- [Let's Encrypt æ–‡æ¡£](https://letsencrypt.org/docs/)

---

**æœ€åæ›´æ–°ï¼š** 2025-12-19
